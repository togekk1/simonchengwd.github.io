onmessage=async e=>{try{const{db_version:o,action:s,database_name:r,objectstore_name:c,objectstores:t,key:a,value:l}=JSON.parse(e.data),n=indexedDB.open(r,o);n.onsuccess=e=>{const o=e.target.result,r=o.transaction([c],"readwrite"),t=r.objectStore(c),n=[()=>t.get(a),()=>t.put(l,a),()=>t.count(),()=>t.getAll()][s]();n.onsuccess=function(){var e=n.result;[0,2,3].includes(s)&&postMessage(2===s?e:JSON.stringify(e))},n.onerror=function(e){console.error(e)},r.oncomplete=function(){o.close(),close()},r.onerror=function(e){console.error(e),o.close(),close()}},n.onerror=e=>{console.error(e),close()},n.onupgradeneeded=r=>{t.forEach(e=>{const o=r.target.result;o.objectStoreNames.contains(e)||o.createObjectStore(e)})}}catch(e){console.error(e)}};